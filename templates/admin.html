<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        .progress-container {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 5px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 0%;
            height: 30px;
            background-color: #4caf50;
            text-align: center;
            line-height: 30px;
            color: white;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div class="console">
    <h1>{{.Title}}</h1>

    <div class="section">
        <h2>Scraping Data</h2>
        <form action="/go_client/start-scraping" method="post">
            <button type="submit" id="scraping-button" {{if or .IsScraping .IsSendingToKafka}}disabled{{end}}>Start Scraping</button>
        </form>
        <h4>{{if .IsScraping}}Вы можете обновить страницу, чтобы увидеть разные активности.{{end}}</h4>
        <div id="scraping-timer">{{if .IsScraping}}Time left: {{.ScrapingTimeLeft}} seconds{{end}}</div>
    </div>

    <div class="section">
        <h2>Data Operations</h2>
        <form action="/go_client/send-to-kafka" method="post">
            <button type="submit" id="kafka-button" {{if or .IsScraping .IsSendingToKafka}}disabled{{end}}>Send Data to Kafka</button>
        </form>
        <h4>{{if .IsScraping}}Вы можете обновить страницу после завершения таймера{{end}}</h4>
        <div id="kafka-timer">{{if .IsSendingToKafka}}Time left: {{.KafkaTimeLeft}} seconds{{end}}</div>
    </div>

    <div class="status-bar">
        {{range .Status}}
        <p>{{.}}</p>
        {{end}}
    </div>
</div>

<script>
    function startProgressBar() {
        let progressBar = document.getElementById('progress-bar');
        let width = 0;
        let interval = setInterval(function() {
            if (width >= 100) {
                clearInterval(interval);
            } else {
                width++;
                progressBar.style.width = width + '%';
                progressBar.innerHTML = width + '%';
            }
        }, 72 * 1000); // Adjust interval timing as needed
    }

    function startTimer(elementId, seconds) {
        let timerElement = document.getElementById(elementId);
        let interval = setInterval(function() {
            if (seconds <= 0) {
                clearInterval(interval);
                timerElement.innerHTML = "";
            } else {
                seconds--;
                timerElement.innerHTML = "Time left: " + seconds + " seconds";
            }
        }, 1000);
    }

    // Start progress bar and timers when the page loads
    window.onload = function() {
        startProgressBar();
        {{if .IsScraping}}
        startTimer("scraping-timer", {{.ScrapingTimeLeft}});
        {{end}}
        {{if .IsSendingToKafka}}
        startTimer("kafka-timer", {{.KafkaTimeLeft}});
        {{end}}
    };
</script>

</body>
</html>
